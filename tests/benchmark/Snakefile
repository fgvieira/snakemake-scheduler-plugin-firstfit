from random import randint as r


rule stepA:
    output:
        "out_1_1/file{shard}.out",
    priority: r(1, 10)
    threads: r(1, 3)
    resources:
        mem_mb=1,
    shell:
        "echo {wildcards.shard} > {output}; sleep 1;"


rule stepB:
    input:
        rules.stepA.output,
    output:
        "out_1_5/file{shard}.out",
    priority: r(1, 10)
    threads: r(1, 3)
    resources:
        mem_mb=5,
    shell:
        "echo {wildcards.shard} | cat - {input} > {output}; sleep 1;"


rule stepC:
    input:
        rules.stepA.output,
        rules.stepB.output,
    output:
        "out_3_1/file{shard}.out",
    priority: r(1, 10)
    threads: r(1, 3)
    resources:
        mem_mb=1,
    shell:
        "echo {wildcards.shard} | cat - {input} > {output}; sleep 1;"


rule all:
    input:
        expand(rules.stepC.output, shard=[r(1, 10000000) for i in range(200000)]),
    default_target: True
